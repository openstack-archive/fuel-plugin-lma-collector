# This task is executed before any real deployment task
- role: ['primary-controller']
  stage: post_deployment/8000
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/check_environment_configuration.pp
    puppet_modules: puppet/modules
    timeout: 300

# The following tasks are executed in the order they are declared

# We need to control what is deployed when we install a new package. So
# we need to prevent the installation of recommended packages.
- role: '*'
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/configure_apt.pp
    puppet_modules: puppet/modules
    timeout: 600

- role: '*'
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/base.pp
    puppet_modules: puppet/modules
    timeout: 600

- role: '*'
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/aggregator.pp
    puppet_modules: puppet/modules
    timeout: 600

- role: ['controller', 'primary-controller']
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/controller.pp
    puppet_modules: puppet/modules
    timeout: 600

- role: [ 'compute' ]
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/compute.pp
    puppet_modules: puppet/modules
    timeout: 600

- role: ['cinder']
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/cinder.pp
    puppet_modules: puppet/modules
    timeout: 600

- role: ['ceph-osd']
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/ceph_osd.pp
    puppet_modules: puppet/modules
    timeout: 600

- role: '*'
  stage: post_deployment/8200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/cleanup_apt_config.pp
    puppet_modules: puppet/modules
    timeout: 600

