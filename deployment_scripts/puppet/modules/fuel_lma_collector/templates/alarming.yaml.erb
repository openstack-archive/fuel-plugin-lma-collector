---
lma_collector:
  alarms:
    - name: 'cpu-critical-controller'
      description: 'The CPU usage is too high (controller node)'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'controller'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 5
            window: 120
            periods: 0
            function: avg
          - metric: cpu_wait
            relational_operator: '>='
            threshold: 35
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-warning-controller'
      description: 'The CPU usage is high (controller node)'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'controller'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 15
            window: 120
            periods: 0
            function: avg
          - metric: cpu_wait
            relational_operator: '>='
            threshold: 25
            window: 120
            periods: 0
            function: avg
    - name: 'swap-usage-critical'
      description: 'There is no more swap free space'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: '*'
      id: swap
      trigger:
        logical_operator: 'or'
        rules:
          - metric: swap_free
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: max
    - name: 'swap-activity-warning'
      description: 'The swap activity is high'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: '*'
      id: swap
      trigger:
        logical_operator: 'or'
        rules:
          - metric: swap_io_in
            relational_operator: '>='
            threshold: 1048576 # 1 Mb/s
            window: 120
            periods: 0
            function: avg
          - metric: swap_io_out
            relational_operator: '>='
            threshold: 1048576 # 1 Mb/s
            window: 120
            periods: 0
            function: avg
    - name: 'swap-usage-warning'
      description: 'The swap free space is low'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: '*'
      id: swap
      trigger:
        rules:
          - metric: swap_percent_used
            relational_operator: '>='
            threshold: 0.8
            window: 60
            periods: 0
            function: avg
    - name: 'cpu-critical-compute'
      description: 'The CPU usage is too high (compute node)'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'compute'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_wait
            relational_operator: '>='
            threshold: 30
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-warning-compute'
      description: 'The CPU usage is high (compute node)'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'compute'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_wait
            relational_operator: '>='
            threshold: 20
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-critical-rabbitmq'
      description: 'The CPU usage is too high (RabbitMQ node)'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-nodes'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 5
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-warning-rabbitmq'
      description: 'The CPU usage is high (RabbitMQ node)'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-nodes'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 15
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-critical-mysql'
      description: 'The CPU usage is too high (MySQL node)'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'mysql-nodes'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 5
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-warning-mysql'
      description: 'The CPU usage is high (MySQL node)'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'mysql-nodes'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 15
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-critical-storage'
      description: 'The CPU usage is too high (storage node)'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'storage'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_wait
            relational_operator: '>='
            threshold: 40
            window: 120
            periods: 0
            function: avg
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 5
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-warning-storage'
      description: 'The CPU usage is high (storage node)'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'storage'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_wait
            relational_operator: '>='
            threshold: 30
            window: 120
            periods: 0
            function: avg
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 15
            window: 120
            periods: 0
            function: avg
    - name: 'cpu-critical-default'
      description: 'The CPU usage is too high'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: '__others__'
      id: cpu
      trigger:
        logical_operator: 'or'
        rules:
          - metric: cpu_wait
            relational_operator: '>='
            threshold: 35
            window: 120
            periods: 0
            function: avg
          - metric: cpu_idle
            relational_operator: '<='
            threshold: 5
            window: 120
            periods: 0
            function: avg
    - name: 'rabbitmq-disk-limit-critical'
      description: 'RabbitMQ has reached the free disk threshold. All producers are blocked'
      severity: 'critical'
      # If the local RabbitMQ instance is down, it will be caught by the
      # rabbitmq-check alarm
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: disk
      trigger:
        logical_operator: 'or'
        rules:
          - metric: rabbitmq_remaining_disk
            relational_operator: '<='
            threshold: 0
            window: 20
            periods: 0
            function: min
    - name: 'rabbitmq-disk-limit-warning'
      description: 'RabbitMQ is getting close to the free disk threshold'
      severity: 'warning'
      # If the local RabbitMQ instance is down, it will be caught by the
      # rabbitmq-check alarm
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: disk
      trigger:
        logical_operator: 'or'
        rules:
          - metric: rabbitmq_remaining_disk
            relational_operator: '<='
            threshold: 104857600 # 100MB
            window: 20
            periods: 0
            function: min
    - name: 'rabbitmq-memory-limit-critical'
      description: 'RabbitMQ has reached the memory threshold. All producers are blocked'
      severity: 'critical'
      # If the local RabbitMQ instance is down, it will be caught by the
      # rabbitmq-check alarm
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: memory
      trigger:
        logical_operator: 'or'
        rules:
          - metric: rabbitmq_remaining_memory
            relational_operator: '<='
            threshold: 0
            window: 20
            periods: 0
            function: min
    - name: 'rabbitmq-memory-limit-warning'
      description: 'RabbitMQ is getting close to the memory threshold'
      severity: 'warning'
      # If the local RabbitMQ instance is down, it will be caught by the
      # rabbitmq-check alarm
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: memory
      trigger:
        logical_operator: 'or'
        rules:
          - metric: rabbitmq_remaining_memory
            relational_operator: '<='
            threshold: 104857600 # 100MB
            window: 20
            periods: 0
            function: min
    - name: 'rabbitmq-queue-warning'
      description: 'The number of outstanding messages is too high'
      severity: 'warning'
      # If the local RabbitMQ instance is down, it will be caught by the
      # rabbitmq-check alarm
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: queue
      trigger:
        logical_operator: 'or'
        rules:
          - metric: rabbitmq_messages
            relational_operator: '>='
            threshold: 200
            window: 120
            periods: 0
            function: avg
    - name: 'rabbitmq-pacemaker-down'
      description: 'The RabbitMQ cluster is down'
      severity: 'down'
      no_data_policy: 'skip' # the metric is only collected from the DC node
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: pacemaker
      trigger:
        logical_operator: 'and'
        rules:
          - metric: pacemaker_resource_percent
            fields:
              resource: rabbitmq
              status: up
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'rabbitmq-pacemaker-critical'
      description: 'The RabbitMQ cluster is critical because less than half of the nodes are up'
      severity: 'critical'
      no_data_policy: 'skip' # the metric is only collected from the DC node
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: pacemaker
      trigger:
        logical_operator: 'and'
        rules:
          - metric: pacemaker_resource_percent
            fields:
              resource: rabbitmq
              status: up
            relational_operator: '<'
            threshold: 50
            window: 60
            periods: 0
            function: last
    - name: 'rabbitmq-pacemaker-warning'
      description: 'The RabbitMQ cluster is degraded because some RabbitMQ nodes are missing'
      severity: 'warning'
      no_data_policy: 'skip' # the metric is only collected from the DC node
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-cluster'
      id: pacemaker
      trigger:
        logical_operator: 'and'
        rules:
          - metric: pacemaker_resource_percent
            fields:
              resource: rabbitmq
              status: up
            relational_operator: '<'
            threshold: 100
            window: 60
            periods: 0
            function: last
    - name: 'apache-warning'
      description: 'There is no Apache idle workers available'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'apache'
      id: worker
      trigger:
        logical_operator: 'or'
        rules:
          - metric: apache_idle_workers
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: min
    - name: 'apache-check'
      description: 'Apache cannot be checked'
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'apache'
      id: check
      trigger:
        rules:
          - metric: apache_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'log-fs-warning'
      description: "The log filesystem's free space is low"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'controller'
      id: log-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/log'
            relational_operator: '<'
            threshold: 10
            window: 60
            periods: 0
            function: min
    - name: 'log-fs-critical'
      description: "The log filesystem's free space is too low"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'controller'
      id: log-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/log'
            relational_operator: '<'
            threshold: 5
            window: 60
            periods: 0
            function: min
    - name: 'root-fs-warning'
      description: "The root filesystem's free space is low"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: '*'
      id: root-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/'
            relational_operator: '<'
            threshold: 10
            window: 60
            periods: 0
            function: min
    - name: 'root-fs-critical'
      description: "The root filesystem's free space is too low"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: '*'
      id: root-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/'
            relational_operator: '<'
            threshold: 5
            window: 60
            periods: 0
            function: min
    - name: 'mysql-fs-warning'
      description: "The MySQL filesystem's free space is low"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'mysql-nodes'
      id: mysql-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/lib/mysql'
            relational_operator: '<'
            threshold: 10
            window: 60
            periods: 0
            function: min
    - name: 'mysql-fs-critical'
      description: "The MySQL filesystem's free space is too low"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'mysql-nodes'
      id: mysql-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/lib/mysql'
            relational_operator: '<'
            threshold: 5
            window: 60
            periods: 0
            function: min
    - name: 'nova-fs-warning'
      description: "The filesystem's free space is low (compute node)"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'compute'
      id: nova-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/lib/nova'
            relational_operator: '<'
            threshold: 10
            window: 60
            periods: 0
            function: min
    - name: 'nova-fs-critical'
      description: "The filesystem's free space is too low (compute node)"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'compute'
      id: nova-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/lib/nova'
            relational_operator: '<'
            threshold: 5
            window: 60
            periods: 0
            function: min
    - name: 'nova-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on nova-api'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'nova-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'nova-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'nova-logs-error'
      description: 'Too many errors have been detected in Nova logs'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'nova-logs'
      id: error
      trigger:
        logical_operator: 'or'
        rules:
          - metric: log_messages
            fields:
              service: 'nova'
              level: 'error'
            relational_operator: '>'
            threshold: 0.1
            window: 70
            periods: 0
            function: max
    - name: 'heat-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on heat-api'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'heat-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'heat-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'heat-logs-error'
      description: 'Too many errors have been detected in Heat logs'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'heat-logs'
      id: error
      trigger:
        logical_operator: 'or'
        rules:
          - metric: log_messages
            fields:
              service: 'heat'
              level: 'error'
            relational_operator: '>'
            threshold: 0.1
            window: 70
            periods: 0
            function: max
    - name: 'swift-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on swift-api'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'swift-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'swift-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'cinder-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on cinder-api'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'cinder-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'cinder-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'cinder-logs-error'
      description: 'Too many errors have been detected in Cinder logs'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'cinder-logs'
      id: error
      trigger:
        logical_operator: 'or'
        rules:
          - metric: log_messages
            fields:
              service: 'cinder'
              level: 'error'
            relational_operator: '>'
            threshold: 0.1
            window: 70
            periods: 0
            function: max
    - name: 'glance-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on glance-api'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'glance-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'glance-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'glance-logs-error'
      description: 'Too many errors have been detected in Glance logs'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'glance-logs'
      id: error
      trigger:
        logical_operator: 'or'
        rules:
          - metric: log_messages
            fields:
              service: 'glance'
              level: 'error'
            relational_operator: '>'
            threshold: 0.1
            window: 70
            periods: 0
            function: max
    - name: 'neutron-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on neutron-api'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'neutron-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'neutron-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'neutron-logs-error'
      description: 'Too many errors have been detected in Neutron logs'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'neutron-logs'
      id: error
      trigger:
        logical_operator: 'or'
        rules:
          - metric: log_messages
            fields:
              service: 'neutron'
              level: 'error'
            relational_operator: '>'
            threshold: 0.1
            window: 70
            periods: 0
            function: max
    - name: 'keystone-response-time-duration'
      description: 'Keystone API is too slow'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'keystone-response-time'
      id: duration
      trigger:
        logical_operator: 'or'
        rules:
          - metric: openstack_keystone_http_response_times
            fields:
              http_method: '== GET || == POST'
              http_status: '!= 5xx'
            relational_operator: '>'
            threshold: 0.3
            window: 60
            periods: 0
            value: upper_90
            function: max
    - name: 'keystone-public-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on keystone-public-api'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'keystone-public-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'keystone-public-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'keystone-admin-api-http-errors'
      description: 'Too many 5xx HTTP errors have been detected on keystone-admin-api'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'keystone-admin-api'
      id: http_errors
      trigger:
        logical_operator: 'or'
        rules:
          - metric: haproxy_backend_response_5xx
            fields:
              backend: 'keystone-admin-api'
            relational_operator: '>'
            threshold: 0
            window: 60
            periods: 1
            function: diff
    - name: 'keystone-logs-error'
      description: 'Too many errors have been detected in Keystone logs'
      severity: 'warning'
      no_data_policy: 'okay'
      enabled: 'true'
      compute_on_cluster: 'keystone-logs'
      id: error
      trigger:
        logical_operator: 'or'
        rules:
          - metric: log_messages
            fields:
              service: 'keystone'
              level: 'error'
            relational_operator: '>'
            threshold: 0.1
            window: 70
            periods: 0
            function: max
    - name: 'mysql-node-connected'
      description: 'The MySQL service has lost connectivity with the other nodes'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'mysql'
      id: node-status
      trigger:
        logical_operator: 'or'
        rules:
          - metric: mysql_cluster_connected
            relational_operator: '=='
            threshold: 0
            window: 30
            periods: 1
            function: min
    - name: 'mysql-node-ready'
      description: "The MySQL service isn't ready to serve queries"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'mysql'
      id: node-status
      trigger:
        logical_operator: 'or'
        rules:
          - metric: mysql_cluster_ready
            relational_operator: '=='
            threshold: 0
            window: 30
            periods: 1
            function: min
    - name: 'ceph-health-critical'
      description: 'Ceph health is critical'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'ceph-mon-cluster'
      id: health
      trigger:
        rules:
          - metric: ceph_health
            relational_operator: '=='
            threshold: 3 # HEALTH_ERR
            window: 60
            function: max
    - name: 'ceph-health-warning'
      description: 'Ceph health is warning'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'ceph-mon-cluster'
      id: health
      trigger:
        rules:
          - metric: ceph_health
            relational_operator: '=='
            threshold: 2 # HEALTH_WARN
            window: 60
            function: max
    - name: 'ceph-capacity-critical'
      description: 'Ceph free capacity is too low'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'ceph-mon-cluster'
      id: capacity
      trigger:
        rules:
          - metric: ceph_pool_total_percent_free
            relational_operator: '<'
            threshold: 2
            window: 60
            function: max
    - name: 'ceph-capacity-warning'
      description: 'Ceph free capacity is low'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'ceph-mon-cluster'
      id: capacity
      trigger:
        rules:
          - metric: ceph_pool_total_percent_free
            relational_operator: '<'
            threshold: 5
            window: 60
            function: max
    - name: 'elasticsearch-health-critical'
      description: 'Elasticsearch cluster health is critical'
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'elasticsearch-cluster'
      id: health
      trigger:
        rules:
          - metric: elasticsearch_cluster_health
            relational_operator: '=='
            threshold: 3 # red
            window: 60
            function: min
    - name: 'elasticsearch-health-warning'
      description: 'Elasticsearch health is warning'
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'elasticsearch-cluster'
      id: health
      trigger:
        rules:
          - metric: elasticsearch_cluster_health
            relational_operator: '=='
            threshold: 2 # yellow
            window: 60
            function: min
    - name: 'elasticsearch-fs-warning'
      description: "The filesystem's free space is low (Elasticsearch node)"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'elasticsearch-nodes'
      id: data-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/opt/es/data' # Real FS is /opt/es-data but Collectd substituted '/' by '-'
            relational_operator: '<'
            threshold: 20 # The low watermark for disk usage is 85% by default
            window: 60
            periods: 0
            function: min
    - name: 'elasticsearch-fs-critical'
      description: "The filesystem's free space is too low (Elasticsearch node)"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'elasticsearch-nodes'
      id: data-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/opt/es/data' # Real FS is /opt/es-data but Collectd substituted '/' by '-'
            relational_operator: '<'
            threshold: 15 # The high watermark for disk usage is 90% by default
            window: 60
            periods: 0
            function: min
    - name: 'influxdb-fs-warning'
      description: "The filesystem's free space is low (InfluxDB node)"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'influxdb-nodes'
      id: data-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/lib/influxdb'
            relational_operator: '<'
            threshold: 10
            window: 60
            periods: 0
            function: min
    - name: 'influxdb-fs-critical'
      description: "The filesystem's free space is too low (InfluxDB node)"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: 'influxdb-nodes'
      id: data-fs
      trigger:
        rules:
          - metric: fs_space_percent_free
            fields:
              fs: '/var/lib/influxdb'
            relational_operator: '<'
            threshold: 5
            window: 60
            periods: 0
            function: min
    - name: 'haproxy-check'
      description: "HAProxy cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'haproxy-openstack'
      id: check
      trigger:
        rules:
          - metric: haproxy_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'rabbitmq-check'
      description: "RabbitMQ cannot be checked"
      # This alarm's severity is warning because the effective status of the
      # RabbitMQ cluster is computed by rabbitmq-pacemaker-* alarms.
      # This alarm is still useful because it will report the node(s) on which
      # RabbitMQ isn't running.
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: 'rabbitmq-service'
      id: check
      trigger:
        rules:
          - metric: rabbitmq_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'ceph-mon-check'
      description: "Ceph monitor cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'ceph-mon-service'
      id: check
      trigger:
        rules:
          - metric: ceph_mon_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'ceph-osd-check'
      description: "Ceph OSD cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'ceph-osd-service'
      id: check
      trigger:
        rules:
          - metric: ceph_osd_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'pacemaker-check'
      description: "Pacemaker cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'pacemaker-service'
      id: check
      trigger:
        rules:
          - metric: pacemaker_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'elasticsearch-check'
      description: "Elasticsearch cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'elasticsearch-service'
      id: check
      trigger:
        rules:
          - metric: elasticsearch_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'influxdb-check'
      description: "InfluxDB cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'influxdb-service'
      id: check
      trigger:
        rules:
          - metric: influxdb_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'libvirt-check'
      description: "Libvirt cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'libvirt-service'
      id: check
      trigger:
        rules:
          - metric: libvirt_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'memcached-check'
      description: "memcached cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'memcached-service'
      id: check
      trigger:
        rules:
          - metric: memcached_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'mysql-check'
      description: "MySQL cannot be checked"
      severity: 'down'
      enabled: 'true'
      compute_on_cluster: 'mysql'
      id: check
      trigger:
        rules:
          - metric: mysql_check
            relational_operator: '=='
            threshold: 0
            window: 60
            periods: 0
            function: last
    - name: 'network-warning-dropped-rx'
      description: "Some received packets have been dropped"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: '*'
      id: network-rx
      trigger:
        rules:
          - metric: if_dropped_rx
            relational_operator: '>'
            threshold: 100
            window: 60
            periods: 0
            function: avg
    - name: 'network-critical-dropped-rx'
      description: "Too many received packets have been dropped"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: '*'
      id: network-rx
      trigger:
        rules:
          - metric: if_dropped_rx
            relational_operator: '>'
            threshold: 1000
            window: 60
            periods: 0
            function: avg
    - name: 'network-warning-dropped-tx'
      description: "Some transmitted packets have been dropped"
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: '*'
      id: network-tx
      trigger:
        rules:
          - metric: if_dropped_tx
            relational_operator: '>'
            threshold: 100
            window: 60
            periods: 0
            function: avg
    - name: 'network-critical-dropped-tx'
      description: "Too many transmitted packets have been dropped"
      severity: 'critical'
      enabled: 'true'
      compute_on_cluster: '*'
      id: network-tx
      trigger:
        rules:
          - metric: if_dropped_tx
            relational_operator: '>'
            threshold: 1000
            function: avg
            window: 60
    - name: 'instance-creation-time-warning'
      description: "Instance creation takes too much time"
      severity: 'warning'
      no_data_policy: 'okay' # This is a sporadic metric
      enabled: 'true'
      # Alarm is computed by the aggregator
      compute_on_cluster: '__aggregator__'
      # but applies to the 'virtual' service cluster nova-dataplane
      apply_to_cluster: 'nova-dataplane'
      id: nova-instances
      trigger:
        rules:
          - metric: openstack_nova_instance_creation_time
            relational_operator: '>'
            threshold: 20
            window: 600
            periods: 0
            function: avg
    - name: 'openstack_nova_used_vcpu-warning'
      description: ""
      severity: 'warning'
      enabled: 'true'
      compute_on_cluster: '__aggregator__'
      apply_to_cluster: 'compute'
      id: nova-compute-vcpu
      trigger:
        rules:
          - metric: openstack_nova_used_vcpu
            relational_operator: '<'
            threshold: 2
            window: 600
            periods: 0
            function: max
            # We need to emit a distinct AFD message per compute node
            group_by: ['hostname']
            # This option DO NOT exists yet
            one_afd_per_alert: true

  # Mapping between the Fuel roles and the AFD filters
  cluster_roles:
    # Cluster nodes
    controller: 
      roles: ['primary-controller', 'controller']
      type: node
<% if @detach_database_enabled -%>
    mysql-nodes:
      roles: ['primary-standalone-database', 'standalone-database']
      type: node
<% else -%>
    mysql-nodes:
      roles: ['primary-controller', 'controller']
      type: node
<% end -%>
    compute:
      roles: ['compute']
      type: node
    storage:
      roles: ['cinder', 'ceph-osd']
      type: node
    elasticsearch-nodes:
      roles: ['primary-elasticsearch_kibana', 'elasticsearch_kibana']
      type: node
    influxdb-nodes:
      roles: ['primary-influxdb_grafana', 'influxdb_grafana']
      type: node

    # Cluster services
<% if @detach_rabbitmq_enabled -%>
    rabbitmq-cluster:
      roles: ['primary-standalone-rabbitmq', 'standalone-rabbitmq']
      type: service
    rabbitmq-service:
      roles: ['primary-standalone-rabbitmq', 'standalone-rabbitmq']
      type: service
<% else -%>
    rabbitmq-cluster:
      roles: ['primary-controller', 'controller']
      type: service
    rabbitmq-service:
      roles: ['primary-controller', 'controller']
      type: service
<% end -%>
<% if @detach_database_enabled -%>
    mysql:
      roles: ['primary-standalone-database', 'standalone-database']
      type: service
<% else -%>
    mysql:
      roles: ['primary-controller', 'controller']
      type: service
<% end -%>
    apache:
      roles: ['primary-controller', 'controller']
      type: service
    nova-api:
      roles: ['primary-controller', 'controller']
      type: service
    nova-logs:
      roles: ['primary-controller', 'controller', 'compute']
      type: service
    heat-api:
      roles: ['primary-controller', 'controller']
      type: service
    heat-logs:
      roles: ['primary-controller', 'controller']
      type: service
<% if not @storage_options["objects_ceph"] then -%>
    swift-api:
      roles: ['primary-controller', 'controller']
      type: service
<% end -%>
    cinder-api:
      roles: ['primary-controller', 'controller']
      type: service
    cinder-logs:
      roles: ['primary-controller', 'controller', 'cinder']
      type: service
    glance-api:
      roles: ['primary-controller', 'controller']
      type: service
    glance-logs:
      roles: ['primary-controller', 'controller']
      type: service
    neutron-api:
      roles: ['primary-controller', 'controller']
      type: service
    neutron-logs:
      roles: ['primary-controller', 'controller', 'compute']
      type: service
    keystone-response-time:
      roles: ['primary-controller', 'controller']
      type: service
    keystone-public-api:
      roles: ['primary-controller', 'controller']
      type: service
    keystone-admin-api:
      roles: ['primary-controller', 'controller']
      type: service
    keystone-logs:
      roles: ['primary-controller', 'controller']
      type: service
    nova-instances:
      roles: ['primary-controller', 'controller']
      type: service
<% if @storage_options["volumes_ceph"] then -%>
    ceph-mon-cluster:
      roles: ['primary-controller', 'controller']
      type: service
    ceph-mon-service:
      roles: ['primary-controller', 'controller']
      type: service
    ceph-osd-service:
      roles: ['ceph-osd']
      type: service
<% end -%>
    elasticsearch-cluster:
      roles: ['primary-elasticsearch_kibana', 'elasticsearch_kibana']
      type: service
    elasticsearch-service:
      roles: ['primary-elasticsearch_kibana', 'elasticsearch_kibana']
      type: service
    influxdb-service:
      roles: ['primary-influxdb_grafana', 'influxdb_grafana']
      type: service
    pacemaker-service:
      roles: ['primary-controller', 'controller']
      type: service
    haproxy-openstack:
      roles: ['primary-controller', 'controller']
      type: service
    libvirt-service:
      roles: ['compute']
      type: service
    memcached-service:
      roles: ['primary-controller', 'controller']
      type: service
    __aggregator__:
      roles: ['primary-controller', 'controller']
      type: internal
    nova-dataplane:
      roles: []
      type: virtual
      description: '....'
    neutron-dataplane:
      roles: []
      type: virtual
      description: '....'
