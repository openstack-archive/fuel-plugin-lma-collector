---
lma_collector:
  gse_cluster_service:
    input_message_types:
      - afd_service_metric
    aggregator_flag: true
    entity_field: service
    output_message_type: gse_service_cluster_metric
    output_metric_name: cluster_service_status
    interval: 10
    sources:
      nova-api:
        - backends
        - endpoint
      nova-ec2-api:
        - backends
      nova-novncproxy-websocket:
        - backends
      nova-metadata-api:
        - backends
      nova-scheduler:
        - workers
      nova-conductor:
        - workers
      nova-compute:
        - workers
      cinder-api:
        - backends
        - endpoint
        - v2-endpoint
      cinder-scheduler:
        - workers
      cinder-conductor:
        - workers
      cinder-compute:
        - workers
      neutron-api:
        - backends
        - endpoint
      neutron-l3:
        - agents
      neutron-dhcp:
        - agents
      neutron-metadata:
        - agents
      neutron-openvswitch:
        - agents
      keystone-public-api:
        - backends
        - endpoint
      keystone-admin-api:
        - backends
        - endpoint
      glance-api:
        - backends
        - endpoint
      glance-registry-api:
        - backends
      heat-api:
        - backends
        - endpoint
      heat-cfn-api:
        - backends
        - endpoint
      horizon-ui:
        - backends
      horizon-https:
        - backends
<% if not @storage_options["objects_ceph"] then -%>
      swift-api:
        - backends
        - endpoint
      swift-s3-api:
        - backends
        - endpoint
<% end -%>
      ceilometer-api:
        - backends
        - endpoint

    level_1_dependencies:
      nova-api:
        - keystone-api
      cinder-api:
        - keystone-api
      neutron-api:
        - keystone-api
      glance-api:
        - keystone-api
      heat-api:
        - keystone-api
      horizon-ui:
        - keystone-api
<% if not @storage_options["objects_ceph"] then -%>
      swift-api:
        - keystone-api
      swift-s3-api:
        - keystone-api
<% end -%>
<% if @ceilometer_enabled -%>
      ceilometer-api:
        - keystone-api
<% end -%>
    level_2_dependencies: {}
  gse_cluster_node:
    input_message_types:
      - afd_node_metric
    aggregator_flag: true
    entity_field: hostname
    output_message_type: gse_node_cluster_metric
    output_metric_name: cluster_node_status
    interval: 10
    level_1_dependencies: {}
    level_2_dependencies: {}
  gse_cluster_global:
    input_message_types:
      - gse_service_cluster_metric
      - gse_node_cluster_metric
    aggregator_flag: false
    entity_field: cluster_name
    output_message_type: gse_cluster_metric
    output_metric_name: cluster_status
    interval: 10
    level_1_dependencies:
      nova:
        - nova-api
        - nova-scheduler
        - nova-compute
        - nova-conductor
        - nova-novncproxy
        - nova-metadata-api
      cinder:
        - cinder-api
        - cinder-scheduler
        - cinder-volume
      neutron:
        - neutron-api
        - neutron-l3
        - neutron-dhcp
        - neutron-metadata
        - neutron-openvswitch
      keystone:
        - keystone-public-api
        - keystone-admin-api
      glance:
        - glance-api
        - glance-registry-api
      heat:
        - heat-api
        - heat-cfn-api
      horizon:
        - horizon-ui
<% if @tls_enabled then -%>
   - horizon-https
<% end -%>
<% if not @storage_options["objects_ceph"] then -%>
      swift:
        - swift-api
        - swift-s3-api
<% end -%>
    level_2_dependencies:
      nova-api:
        - neutron-api
        - keystone-api
        - cinder-api
        - glance-api
      cinder-api:
        - swift-api
      neutron-api:
        - keystone-api
      glance-api:
        - swift-api
      heat-api:
        - nova-api
        - neutron-api
        - keystone-api
        - cinder-api
        - glance-api
<% if @ceilometer_enabled -%>
        - ceilometer-api
<% end -%>
